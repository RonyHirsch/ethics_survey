geom_bar(position = position_fill()) +
mod1 <- clmm(ordered(Rating) ~ Item * exp_animals + (1 | response_id),
link = "logit",
data = data_consciousness)
data_consciousness %>%
mutate(
Item = forcats::fct_reorder(Item, Rating)
) %>%
ggplot(aes(Item, fill = ordered(Rating))) +
facet_grid(cols = vars(cut_number(exp_animals, 3)),
rows = vars(cut_number(exp_ethics, 3))) +
geom_bar(position = position_fill())
data_consciousness %>%
pivot_wider(names_from = Item, values_from = Rating, id_cols = response_id)
data_consciousness %>%
pivot_wider(names_from = Item, values_from = Rating, id_cols = response_id)
data_consciousness %>%
pivot_wider(names_from = Item, values_from = Rating, id_cols = response_id) %>%
select(-1) %>%
dist()
dists <- data_consciousness %>%
pivot_wider(names_from = Item, values_from = Rating, id_cols = response_id) %>%
dplyr::select(-1) %>%
dist()
h.clust <- hclust(dists, method = "complete")
cutree(h.clust, k = 4)
glimpse(cv_data)
cv_data %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
)
cv_data %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating)
cv_data %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
with({
cor.test(Consciousness, `Moral Status`)
})
data_for_cor <- cv_data %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating)
cor.test(data_for_cor$Consciousness, data_for_cor$`Moral Status`)
plot(data_for_cor$Consciousness, data_for_cor$`Moral Status`)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 10)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_point()
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 10)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm")
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 10)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red")
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
cor.test(data_for_cor$Consciousness, data_for_cor$`Moral Status`)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_point(data = data_for_cor) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_point(data = data_for_cor, size = 3) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2) +
geom_point(data = data_for_cor, size = 3)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 50)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2) +
geom_point(data = data_for_cor, size = 3, color = "red")
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 100)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating)
cv_data %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
data_consciousness %>%
distinct(response_id, .keep_all = TRUE) %>%
dplyr::select(all_of(column_names)) %>%
cor()
corr <- data_consciousness %>%
distinct(response_id, .keep_all = TRUE) %>%
dplyr::select(all_of(column_names)) %>%
cor()
corr
data_consciousness %>%
mutate(
Item = forcats::fct_reorder(Item, Rating)
) %>%
ggplot(aes(Item, fill = ordered(Rating))) +
facet_grid(cols = vars(cut_number(exp_animals, 3)),
rows = vars(cut_number(exp_ethics, 3))) +
geom_bar(position = position_fill())
dists <- data_consciousness %>%
pivot_wider(names_from = Item, values_from = Rating, id_cols = response_id) %>%
dplyr::select(-1) %>%
dist()
dists
View(data_for_cor)
cor.test(data_for_cor$Consciousness, data_for_cor$`Moral Status`)
plot(data_for_cor$Consciousness, data_for_cor$`Moral Status`)
library(ordinal)
library(tidyr)
library(dplyr)
library(lme4)
library(lmerTest)
library(bayestestR)
library(emmeans)
library(lsmeans)
library(psych)
library(ggplot2)
library(poLCA)
library(flexmix)
library(reshape2)
library(rstudioapi)
"
Consciousness vs Moral Status Ratings
"
## Load Data ------------------------
# ------- long format -------
long_path <- file.choose()
cv_data_long <- read.csv(long_path)  # c_v_ms_long file
# treat categorical data as such
cv_data_long$response_id <- factor(cv_data_long$response_id)
cv_data_long$Topic <- factor(cv_data_long$Topic)
cv_data_long$Item <- factor(cv_data_long$Item)
# tread Rating as ordered data
cv_data_long$Rating <- ordered(cv_data_long$Rating)
data_for_cor <- cv_data_long %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating)
View(data_for_cor)
wide_path <- file.choose()
cv_data_wide <- read.csv(wide_path)
View(cv_data_wide)
View(cv_data_long)
View(cv_data_long)
long_path <- file.choose()
cv_data_long <- read.csv(long_path)  # c_v_ms_long file
# treat categorical data as such
cv_data_long$response_id <- factor(cv_data_long$response_id)
cv_data_long$Topic <- factor(cv_data_long$Topic)
cv_data_long$Item <- factor(cv_data_long$Item)
data_for_cor <- cv_data_long %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating)
View(data_for_cor)
View(data_for_cor)
View(data_for_cor)
cv_data_for_cor <- cv_data_long %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating)
correlation <- cor.test(cv_data_for_cor$Consciousness, cv_data_for_cor$`Moral Status`)
print(correlation)
plot(cv_data_for_cor$Consciousness, cv_data_for_cor$`Moral Status`)
cv_data_long %>%
pivot_wider(names_from = Topic, values_from = Rating) %>%
filter(
response_id %in% sample(levels(response_id), 100)
) %>%
ggplot(aes( Consciousness, `Moral Status`)) +
geom_smooth(aes(group = response_id), method = "lm", se = FALSE) +
geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 2)
library(ordinal)
library(tidyr)
library(dplyr)
library(lme4)
library(lmerTest)
library(bayestestR)
library(emmeans)
library(lsmeans)
library(psych)
library(ggplot2)
library(poLCA)
library(flexmix)
library(reshape2)
library(rstudioapi)
library(car)
library(caret)
library(multcomp)
"
Earth in danger clustering results logistic regression
"
## Load ------------------------
curr_path <- file.choose()
data <- read.csv(curr_path)  # clusters_with_demographic file
# treat categorical data as such
data$response_id <- factor(data$response_id)
data$Cluster <- factor(data$Cluster)  # making sure that the cluster (a binary tag) is referred to as such
## Model ------------------------
logit_model <- glm(Cluster ~ exp_animals + exp_ethics + exp_ai + exp_consciousness,
data = data, family = binomial)
print(summary(logit_model))
print("                ")
## Model Performance ------------------------
print("------Model Performance------")
# Wald Chi-squared test for overall model fit
print("Wald Chi-squared test")
model_fit <- anova(logit_model, test = "Chisq")
print(model_fit)
print("                ")
print("confusion matrix")
predicted_probs <- predict(logit_model, type = "response")
predicted_classes <- factor(predicted_probs > 0.5, levels = c(FALSE, TRUE), labels = 0:1)
conf_mat <- confusionMatrix(predicted_classes, data$Cluster)
print(conf_mat)
print("                ")
predicted_df <- data.frame(
Culster = data$Cluster,
predicted_classes,
predicted_probs
)
yardstick::roc_curve(predicted_df, truth = Culster, predicted_probs, event_level = "second") %>% autoplot()
yardstick::roc_auc(predicted_df, truth = Culster, predicted_probs, event_level = "second")
## Effect Significance ------------------------
print("                ")
print("------Effect Significance------")
# Anova function from the car package for post-hoc comparisons
result_effects <- car::Anova(logit_model, type = 2)
# correct p-values with Bonferroni
result_effects[["Pr(>Chisq)_corrected"]] <- p.adjust(result_effects[["Pr(>Chisq)"]], method = "bonf")
print(result_effects)
print("                ")
## Bayes Factors ------------------------
print("------Bayes Factors------")
result_effects$BF <- p_to_bf(result_effects$"Pr(>Chisq)", n_obs = nobs(logit_model))[["BF"]]
as.data.frame(result_effects)
print(result_effects)
print("                ")
## Effect Sizes ------------------------
print("------Effect Sizes------")
library(marginaleffects)
avg_slopes(logit_model)
data_for_plot <- bind_rows(
ai = avg_predictions(logit_model, variables = "exp_ai"),
animals = avg_predictions(logit_model, variables = "exp_animals"),
consciousness = avg_predictions(logit_model, variables = "exp_consciousness"),
ethics = avg_predictions(logit_model, variables = "exp_ethics"),
.id = "predictor"
) %>%
mutate(
x = coalesce(exp_animals, exp_ethics, exp_consciousness, exp_ai)
)
ggplot(data_for_plot, aes(x, estimate, fill = predictor, color = predictor)) +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high), color = NA, alpha = 0.6) +
geom_line() +
scale_y_continuous(limits = c(0, 1), labels = scales::label_percent())
ggplot(data_for_plot, aes(x, estimate, fill = predictor, color = predictor)) +
geom_pointrange(aes(ymin = conf.low, ymax = conf.high)) +
geom_line() +
scale_y_continuous(limits = c(0, 1), labels = scales::label_percent())
conf_mat <- confusionMatrix(predicted_classes, data$Cluster)
print(conf_mat)
print(result_effects)
library(ordinal)
library(tidyr)
library(dplyr)
library(lme4)
library(lmerTest)
library(bayestestR)
library(emmeans)
library(lsmeans)
library(psych)
library(ggplot2)
library(poLCA)
library(flexmix)
library(reshape2)
library(rstudioapi)
"
Consciousness vs Moral Status Ratings
"
cv_data_for_cor <- cv_data_long %>%
group_by(Item, Topic) %>%
summarise(
Rating = mean(Rating)
) %>%
pivot_wider(names_from = Topic, values_from = Rating)
View(cv_data_for_cor)
plot(cv_data_for_cor$Consciousness, cv_data_for_cor$`Moral Status`)
View(cv_data_for_cor)
linear_model <- lm(`Moral Status` ~ Consciousness, data=cv_data_for_cor)
abline(linear_model, col = "red", lwd = 2)
residuals(linear_model)
cv_data_for_cor$dist_from_regression_line <- abs(residuals(linear_model))
View(cv_data_for_cor)
data_consciousness <- cv_data_long[cv_data_long$Topic == "Consciousness",]
data_ms <- cv_data_long[cv_data_long$Topic == "Moral Status",]
dataframes <- list(data_consciousness, data_ms)
dataframes_names <- list("consciousness", "moralstatus")
column_names <- c("exp_animals", "exp_consc", "exp_ethics", "exp_ai")
### model the data -----------------------------------
# for each topic (consciousness, moral status) check whether experience
# in any of these fields (column names) affected the ratings.
print("                ")
print("---------------------- Linear Mixed-Effects Model ----------------------")
options(lmerTest.limit = 500000)  # we have many observations
for (i in seq_along(dataframes)) {
df <- dataframes[[i]]
df_name <- dataframes_names[i]
print("                ")
print(paste(" ------- ", df_name, " ------- "))
print("                ")
print("correlation between experience types")
corr <- df %>%
distinct(response_id, .keep_all = TRUE) %>%
dplyr::select(all_of(column_names)) %>%
cor()
print(corr)
print("                ")
print("                ")
print("variance between items and people: Model only with Random Intercepts")
empty_mod <- clmm(ordered(Rating) ~ (1 | response_id) + (1 | Item),
link = "logit",
data = df)
print("model summary")
print(summary(empty_mod))
print("                ")
print("                ")
print("Model ICC score")
print(performance::icc(mod, by_group = TRUE))
print("                ")
for (col in column_names){
print("                ")
print(paste(" --- ", df_name, " model rating ", "by ", col, " --- "))
mod <- clmm(ordered(Rating) ~ Item * col + (1 | response_id),
link = "logit",
data = df)
print("model summary")
print(summary(mod))
print("                ")
print("                ")
print("effect sizes")
# This will give the effect of experience column on rating for each item
emmeans::emtrends(mod, ~ Item, vars = col,
mode = "mean.class", infer = TRUE)
print("                ")
}
}
View(df)
View(cv_data_long)
View(cv_data)
View(cv_data_wide)
View(cv_data_long)
View(cv_data)
cv_data_wider <- cv_data_long %>%
pivot_wider(names_from = topic, values_from = rating)
cv_data_wider <- cv_data_long %>%
pivot_wider(names_from = Topic, values_from = Rating)
View(cv_data_wider)
result <- lmer('Moral Status' ~ Consciousness + (1 | response_id), data = cv_data_wider)
cv_data_wider <- cv_data_long %>%
pivot_wider(names_from = Topic, values_from = Rating)
print("                ")
print("---------------------- LMM between c and MS ----------------------")
result <- lmer('Moral Status' ~ Consciousness + (1 | response_id), data = cv_data_wider)
result <- lmer(`Moral Status` ~ `Consciousness` + (1 | response_id), data = cv_data_wider)
result_summary <- summary(result)
print("*** Model Summary ***")
print(result_summary)
print("                ")
print("                ")
print("---------------------- Effect Significance ----------------------")
result_effects <- anova(result, type=2)
print(result_effects)
# correct p-values with Bonferroni
result_effects[["p_adjust"]] <- p.adjust(result_effects[["Pr(>F)"]], method = "bonf")
print(result_effects, digits=3)
print("                ")
print("---------------------- Bayes Factors ----------------------")
result_effects$BF <- p_to_bf(result_effects$"Pr(>F)", n_obs = nobs(result))[["BF"]]
as.data.frame(result_effects)
# round to 3 digits after the decimal point
result_effects[] <- lapply(result_effects, function(x) if(is.numeric(x)) round(x, 3) else x)
result_effects
print("                ")
print("---------------------- Effect Sizes ----------------------")
print(effectsize::eta_squared(result_effects, ci=0.95, alternative="two.sided"))
result <- lmer(`Moral Status` ~ `Consciousness` + (`Consciousness`| response_id), data = cv_data_wider)
result_summary <- summary(result)
print("*** Model Summary ***")
print(result_summary)
print("                ")
print("                ")
print("---------------------- Effect Significance ----------------------")
result_effects <- anova(result, type=2)
print(result_effects)
# correct p-values with Bonferroni
result_effects[["p_adjust"]] <- p.adjust(result_effects[["Pr(>F)"]], method = "bonf")
print(result_effects, digits=3)
print("                ")
print("---------------------- Bayes Factors ----------------------")
result_effects$BF <- p_to_bf(result_effects$"Pr(>F)", n_obs = nobs(result))[["BF"]]
as.data.frame(result_effects)
# round to 3 digits after the decimal point
result_effects[] <- lapply(result_effects, function(x) if(is.numeric(x)) round(x, 3) else x)
result_effects
result <- lmer(`Moral Status` ~ `Consciousness` + (`Consciousness`| response_id), data = cv_data_wider)
result_summary <- summary(result)
print("*** Model Summary ***")
print(result_summary)
print("                ")
print("                ")
print("---------------------- Effect Significance ----------------------")
result_effects <- anova(result, type=2)
print(result_effects)
# correct p-values with Bonferroni
result_effects[["p_adjust"]] <- p.adjust(result_effects[["Pr(>F)"]], method = "bonf")
print(result_effects, digits=3)
print("                ")
print("---------------------- Bayes Factors ----------------------")
result_effects$BF <- p_to_bf(result_effects$"Pr(>F)", n_obs = nobs(result))[["BF"]]
as.data.frame(result_effects)
result_effects
plot(ranef(model)$response_id)
plot(ranef(result)$response_id)
library(performance)
icc_value <- icc(result)
print(icc_value)
